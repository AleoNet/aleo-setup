![Alt text](./namada-trusted-setup.jpeg?raw=true "Namada Trusted Setup")

<h1 align="center">Namada Trusted Setup</h1>

The Namada Trusted Setup Ceremony generates the public parameters for the Multi-Asset Shielded Pool (MASP) circuit and guarantees its security. Under the hood, a trusted setup ceremony is a multi-party computation (MPC) that lets many participants contribute randomness to the public parameters in a trustless manner. The setup is secure, as long as one participant is honest.

## About Namada

[Namada](https://namada.net/) is a sovereign proof-of-stake blockchain, using Tendermint BFT consensus, that enables multi-asset private transfers for any native or non-native asset using a multi-asset shielded pool derived from the Sapling circuit. 

To learn more about the protocol, we recommend the following resources:

- [Introducing Namada: Shielded Transfers with Any Assets](https://medium.com/anomanetwork/introducing-namada-shielded-transfers-with-any-assets-dce2e579384c)
- [Namada's specifications](https://specs.namada.net)

## Participate in Namada Trusted Setup
If you are interested in participating in the ceremony head over to the [Namada website](https://namada.net/trusted-setup.html) and [sign up to the newsletter](https://dev.us7.list-manage.com/subscribe?u=69adafe0399f0f2a434d8924b&id=9e747afc55) to be notified about the launch.

### Building and contributing from source

First, [install Rust](https://www.rust-lang.org/tools/install) by entering the following command:
```
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

If you already have Rust installed, make sure it is the most up-to-date version:
```
rustup update
```

Once Rust is installed, clone the Namada Trusted Setup Ceremony GitHub repository and change directories into `namada-setup-ceremony`:
```
git clone https://github.com/anoma/namada-trusted-setup.git
cd namada-trusted-setup
```

Build the binaries and start your contribution with:
```
cargo run --release --bin phase1 --features cli contribute https://contribute.namada.net
```

### Understanding the ceremony

1. Upon starting the client, you will be asked if you want to participate in the incentivized program. Then, the client will generate a secret mnemonic that derives your key pair. Make sure to back up your mnemonic and keep it in a safe place. This is the only way to prove your contribution and claim your rewards later.

2. After you save your mnemonic, you will join a queue for the ceremony, and wait until it is your turn. Each round will last between 4-20 min, depending on how each participant chooses to contribute. Your machine needs to be connected to the coordinator at all times, so please close neither your terminal, nor your internet connection. If the coordinator detects that you are offline for a certain amount of time, you will be kicked out from the queue, and have to start from scratch again.

3. When it is your turn, the challenge will be downloaded from the coordinator and saved to the root folder. 

4. Then, the client will ask you a couple of questions depending on how you want to contribute: whether you wish to give your own seed of randomness or compute your contribution on another machine. You will have a maximum of 20 minutes to compute your challenge and send your contribution back to the coordinator. Be creative and good luck!

### CLI Contribution Flow 
![Alt text](./ceremony-contribution-diagram.png?raw=true "Ceremony Contribution Flow")

## Overview of trusted setup ceremonies

Pairing based zk-SNARKs require the generation of certain parameters in order to achieve high efficiency (small proof sizes, fast proving and verifying time). These parameters are generated by another set of parameters which MUST remain secret. We call these secret parameters the "toxic waste". If a prover knows these secrets, [then they can generate valid proofs for invalid statements](https://medium.com/qed-it/how-toxic-is-the-waste-in-a-zksnark-trusted-setup-9b250d59bdb4), breaking soundness. This is undesired!

In order to guarantee that no prover will ever know these secrets, we can generate them in a distributed manner. Each participant in this so-called "ceremony" will contribute to the generation of the parameters with their own secret. If at least 1 participant is honest and destroys their secret, then there should be no way for a malicious prover to create fake proofs.

This repository contains implementations for the [BGM17](https://eprint.iacr.org/2017/1050) multi party computation. The ceremony is split 
in two phases, one which generates the _Powers of Tau_, and one which "specializes" them to the provided arithmetic circuit for the Groth16 zk-SNARK and this is where we will construct our MASP zk-SNARK. 

Note that the generated Powers of Tau can be re-used for any other Phase 2 setup, or for instantiating other mechanisms, such as the [KZG10](https://www.iacr.org/archive/asiacrypt2010/6477178/6477178.pdf) polynomial commitment scheme.

For instructions on how to ensure that the ceremony is executed properly, refer to [`RECOMMENDATIONS.md`](RECOMMENDATIONS.md).


## Directory Structure

This repository contains several Rust crates that implement the different building blocks of the MPC. The high-level structure of the repository is as follows:
- [`phase1-cli`](phase1-cli): Rust crate that provides a HTTP client that communicates with the REST API endpoints of the coordinator and uses the necessary cryptographic functions to contribute to the trusted setup.
- [`phase1-coordinator`](phase1-coordinator): Rust crate that provides a coordinator library and a HTTP REST API that allow contributors to interact with the coordinator. The coordinator handles the operational steps of the ceremony like: adding a new contributor to the queue, authentificating a contributor, sending and receiving challenge files, removing inactive contributors, reattributing challenge file to a new contributor after a contributor dropped, verifying contributions, creating new files, etc.
- [`phase1`](phase1) and [`setup-utils`](setup-utils): contain utils used in both the client and the coordinator.
- The remaining files contain configs for CI and deployment to AWS EC2 and S3 bucket.

## Audits

The original implementation of the coordinator for the [Aleo Trusted Setup](https://github.com/AleoHQ/aleo-setup) was audited by: 

- [Least Authority](https://leastauthority.com/blog/audit-of-aleo-trusted-setup-phase-1/)

## License

All code in this workspace is licensed under either of

 * Apache License, Version 2.0, ([LICENSE-APACHE](LICENSE-APACHE) or http://www.apache.org/licenses/LICENSE-2.0)
 * MIT license ([LICENSE-MIT](LICENSE-MIT) or http://opensource.org/licenses/MIT)

at your option.

### Contribution

Unless you explicitly state otherwise, any contribution intentionally
submitted for inclusion in the work by you, as defined in the Apache-2.0
license, shall be dual licensed as above, without any additional terms or
conditions.

## Community support

- [Discord](https://discord.com/invite/anoma) (Questions and discussions on Namada)
- [Twitter](https://twitter.com/namadanetwork)
